{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "/schemas/wob",
    "title": "Wob-verzoek",
    "description": "Defines a schema to represent a Wob-verzoek",
    "type": "object",
    
    "properties": {
        "wob_id": {"type": ["integer", "string"]},
        "titel": {"type": "string"},
        "verantwoordelijk": {"type": "string"},
        "datum_ingediend": {"type": "string", "format": "date", "pattern": "[0-9]{2}-[0-9]{2}-[0-9]{4}"},
        "datum_besluit": {"type": "string", "format": "date", "pattern": "[0-9]{2}-[0-9]{2}-[0-9]{4}"},
        "beoordeling": {"type": "string", "enum": ["Openbaar", "Deels openbaar", "Reeds openbaar", "Niet openbaar"]},
        "verdaagd": {"type": "boolean"},
        "beschrijving": {"type": "string"},
        "intern_id": {"type": ["integer", "string"]},
        "verzoeker": {"type": "string"},
        "geografisch_gebied": {"type": "string"},
        "bag_id": {"type": "integer"},
        "bgt_id": {"type": "integer"},
        "longitude": {"type": "number", "minimum": -180, "maximum": 180},
        "latitude": {"type": "number", "minimum": -90, "maximum": 90},
        "postcodegebied": {"type": "integer", "minimum": 1000, "maximum": 9999},
        "aantal_documenten": {"type": "integer"},
        "documenten": {"type": "array", "items": {"$ref": "#/$defs/document"}}
    },

    "required": ["id", "titel", "verantwoordelijk", "datum_ingediend", "datum_besluit", "beoordeling", "verdaagd"],

    "$defs": {
         "document": {
            "$schema": "http://json-schema.org/draft-07/schema#",
            "$id": "/schemas/document",
            "title": "Wob-document",
            "description": "Defines a schema to represent a Wob-verzoek",
            "type": "object",
        
            "properties": {
                "document_id": {"type": ["integer", "string"]},
                "bestandsnaam": {"type": "string"},
                "bestandstype": {"type": "string"},
                "documenttype": {"type": "string", "enum": ["Bijlage", "Verzoek", "Besluit", "Inventarislijst"]},
                "url": {"type": "string", "format": "uri"},
                "aantal_paginas": {"type": "integer"},
                "aantal_woorden": {"type": "integer"},
                "aantal_tekstpaginas": {"type": "integer"},
                "download_datum": {"type": "string", "format": "date", "pattern": "[0-9]{2}-[0-9]{2}-[0-9]{4}"},
                "taal": {"type": "string"},
                "scan": {"type": "boolean"},
                "grootte": {"type": "string"}
            },
        
            "required": ["document_nr", "bestandsnaam", "bestandstype", "documenttype", "url"],
        
            "if": {
                "properties": { "documenttype": { "const": "Bijlage" } }
            },
            "then": {
                "properties": { 
                    "bijlagetype": {"type": "string"},
                    "title": {"type": "string"},
                    "beoordeling": {"type": "string", "enum": ["Openbaar", "Deels openbaar", "Reeds openbaar", "Niet openbaar"]},
                    "weigeringsgrond": {"type": "array", "items": { "type": "string"}},
                    "vindplaats_reeds_openbaar": {"type": "string", "format": "uri"},
                    "afzender": {"type": "string"},
                    "ontvanger": {"type": "string"},
                    "datum": {"type": "string", "format": "date", "pattern": "[0-9]{2}-[0-9]{2}-[0-9]{4}"},
                    "toelichting": {"type": "string"}
                },
        
                "required": ["bijlagetype", "beoordeling", "datum"],
        
                "allOf": [
                    {
                        "if": {
                            "properties": { "beoordeling": { "const": "Reeds openbaar" } }
                        },
                        "then": {
                            "required": ["vindplaats_reeds_openbaar"]
                        }
                    },
                    {
                        "if": {
                            "properties": { "beoordeling": { "value": ["Niet openbaar", "Deels openbaar"] } }
                        },
                        "then": {
                            "required": ["weigeringsgrond"]
                        }
                    }
                ]
            }
            
        }
    }
}